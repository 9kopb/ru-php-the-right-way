---
title: Базы данных
---

# Базы данных

Во многих случаях ваш PHP код будет использовать базу данных для сохранения информация. У вас есть несколько вариантов для подключения и взаимодействия с базой данных. Рекомендуемым вариантом _до PHP 5.1.0_ было использование нативных(родных) драйверов, таких как [mysql][mysql], [mysqli][mysqli], [pgsql][pgsql], etc.

Родные драйвера замечательны, если вы исопльзуете ОДНУ базу данных в ваших приложениях, но если, например, вы используете MySQL и немного MSSQL, или вам нужно подключиться в базе данных Oracle, тогда вы не сможете использовать те-же драйвера. Вам нужно будет изучить новое API для каждой базы данных - и это может оказаться глупым.

В качестве дополнительной заметки о нативных драйверах, расширение mysql для PHP больше не находился в активной разработке, и его оффициальным статусом с PHP 5.4.0 является "Устарело в связи с длительным сроком исопльзования". Это значит, что оно будет удалено в течение нескольких следующих релизах, так что в PHP 5.6(или все что выйдет после 5.5) оно вполне может пропасть. Если вы используете `mysql_connect()` и `mysql_query()` в ваших приложениях, тогда вам придется столкнуться с переписыванием кода , поэтому лучшим вариантом является использование mysqli или PDO, заместо mysql в ваших приложениях сейчас, чем столкнуться с нерабочими приложениями потом. _Если вы начинаете с нуля, тогда не откажитесь от использавния расширения mysql: используйте [Расширение MySQLi][mysqli] или PDO._

* [PHP: Выбор API для MySQL](http://php.net/manual/en/mysqlinfo.api.choosing.php)

## PDO

PDO это абстрактная библиотека для подключения к базе данных &mdash; встроенная в PHP с версии 5.1.0 &mdash; что обеспечивает общий интерфейс для общения с большим количеством различных баз данных. PDO не будет переводить ваши SQL запросы или эмулировать отсутствующие возможности; он чист для подключения к нескольким типам баз данных с тем-же API.

Более важно, что `PDO` позволяет вам безопасно вводить пользовательские данные (например идентификатор) в ваши SQL запросы, без беспокойства о SQL инъекциях. Это возможно, благодаря использованию PDO выражений и связывания(bound) параметров.

Предположим, что PHP скрипт получает числовой идентификатор в качестве параметра из запроса. Этот идентификатор должен быть использован для получения пользователских записей из базы данных. Ниже приведен `неправильный` способ сделать это:

{% highlight php %}
<?php
$pdo = new PDO('sqlite:users.db');
$pdo->query("SELECT name FROM users WHERE id = " . $_GET['id']); // <-- Это неправильно!
{% endhighlight %}

Это ужасный код. Вы вставляете сырые параметры в SQL запрос. Это приведет к взлому. Вместо этого, вы должны очистить ввод идентификатора с помощью связывания параметров PDO.

{% highlight php %}
<?php
$pdo = new PDO('sqlite:users.db');
$stmt = $pdo->prepare('SELECT name FROM users WHERE id = :id');
$stmt->bindParam(':id', $_GET['id'], PDO::PARAM_INT); //<-- Автоматически очищено с помощью PDO
$stmt->execute();
{% endhighlight %}

Это правильный код. Он использует связанный параметр в выражении PDO. Это позволяет избежать некоректного пользовательского ввода идентификатора, перед тем, как передать запрос в базу данных, предотвращая потенциальные атаки типа SQL инъекций.

* [Подробнее о PDO][1]

## Уровень абстракции

Многие фрэймворки предоставляют их собственный уровень абстракции, который может или не может сидеть поверх PDO. Они часто будут эмулировать возможности для одной системы баз данных, которые не имеет другая, оборачивая ваши запросы в PHP методы, давая вам фактическую абстракцию базы данных. Это конечно, добавит небольшие накладные расходы, но елси вы строите портативные приложения, которому необходима работа с MySQL, PostgreSQL и SQLite, тогда минимальными накладными расходами, можно пренебречь, для чистоты кода.

Некоторые слои абстракции построенны с использованием PSR-0 стандарта, поэтому могут быть установлены в любое приложение:

* [Doctrine2 DBAL][2]
* [ZF2 Db][4]
* [ZF1 Db][3]

[1]: http://www.php.net/manual/ru/book.pdo.php
[2]: http://www.doctrine-project.org/projects/dbal.html
[3]: http://framework.zend.com/manual/ru/zend.db.html
[4]: http://packages.zendframework.com/docs/latest/manual/ru/zend.db.html

[mysql]: http://php.net/mysql
[mysqli]: http://php.net/mysqli
[pgsql]: http://php.net/pgsql
